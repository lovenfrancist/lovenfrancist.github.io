---
- name: Create new post
  hosts: localhost
  gather_facts: yes
  connection: ssh
  pre_tasks:
    - name: Initialize environment
      set_fact:
        envi: dev
      when: envi is not defined
  tasks:
    - include_role:
        name: packages
        tasks_from: install

    - include_role:
        name: nginx
        tasks_from: configure

    - include_role:
        name: cron
        tasks_from: schedule

    - include_role:
        name: my_exam
        tasks_from: build
      vars:
        envi: dev

    - include_role:
        name: my_exam
        tasks_from: build
      vars:
        envi: staging

    - include_role:
        name: my_exam
        tasks_from: build
      tags: [ 'never', 'build' ]
